<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>AR Debug - Simple Test</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #log {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      background: rgba(0,0,0,0.9);
      color: lime;
      padding: 15px;
      font-family: monospace;
      font-size: 14px;
      z-index: 9999;
      max-height: 300px;
      overflow-y: auto;
      border: 3px solid lime;
    }
  </style>
</head>
<body>
  <div id="log">Starting...</div>

  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
    
    <!-- Load 3D Models -->
    <a-assets>
      <a-asset-item id="capy" src="models/capybara_low_poly.glb"></a-asset-item>
      <a-asset-item id="watermelon" src="models/watermelon.glb"></a-asset-item>
      <a-asset-item id="slice" src="models/slice_of_watermelon.glb"></a-asset-item>
    </a-assets>

    <!-- LIGHTS for 3D models -->
    <a-entity light="type: ambient; intensity: 0.8"></a-entity>
    <a-entity light="type: directional; intensity: 0.6" position="0 1 1"></a-entity>
    
    <!-- JUNGLE MARKER - CAPYBARA -->
    <a-nft
      type="nft"
      url="markers/jungle"
      id="jungle-marker"
      smooth="true"
      smoothCount="10"
      smoothTolerance="0.01"
      smoothThreshold="5">
      
      <!-- CAPYBARA 3D MODEL -->
      <a-entity 
        gltf-model="#capy"
        position="100 100 -100" 
        scale="60 60 60"
        rotation="-90 0 0"
        animation="property: rotation; to: -90 0 360; loop: true; dur: 6000; easing: linear">
      </a-entity>
      
      <!-- TEXT -->
      <a-text
        value="Oh no... I'm hungry!"
        align="center"
        color="#ff0000"
        position="0 65 0"
        scale="20 20 20">
      </a-text>
    </a-nft>

    <!-- DESK MARKER - WATERMELON -->
    <a-nft
      type="nft"
      url="markers/desk"
      id="desk-marker"
      smooth="true"
      smoothCount="10"
      smoothTolerance="0.01"
      smoothThreshold="5">
      
      <!-- WATERMELON 3D MODEL -->
      <a-entity 
        gltf-model="#watermelon"
        position="100 100 -100" 
        scale="50 50 50"
        rotation="-90 0 0"
        animation="property: rotation; to: -90 0 360; loop: true; dur: 7000; easing: linear">
      </a-entity>
      
      <!-- TEXT -->
      <a-text
        value="Wow, this melon looks amazing!"
        align="center"
        color="#00ff00"
        position="0 65 0"
        scale="20 20 20">
      </a-text>
    </a-nft>

    <!-- PICNIC MARKER - HAPPY CAPYBARA + WATERMELON SLICE -->
    <a-nft
      type="nft"
      url="markers/picnic"
      id="picnic-marker"
      smooth="true"
      smoothCount="10"
      smoothTolerance="0.01"
      smoothThreshold="5">
      
      <!-- HAPPY CAPYBARA (bouncing) -->
      <a-entity 
        gltf-model="#capy"
        position="80 100 -100" 
        scale="60 60 60"
        rotation="-90 0 0"
        animation="property: position; dir: alternate; dur: 600; loop: true; to: 80 110 -100; from: 80 100 -100; easing: easeInOutQuad">
      </a-entity>

      <!-- WATERMELON SLICE -->
      <a-entity 
        gltf-model="#slice"
        position="120 100 -100" 
        scale="40 40 40"
        rotation="-90 90 0"
        animation="property: rotation; to: -90 90 360; loop: true; dur: 9000; easing: linear">
      </a-entity>
      
      <!-- TEXT -->
      <a-text
        value="Thank you, now I'm happy!"
        align="center"
        color="#00ffff"
        position="0 70 0"
        scale="20 20 20">
      </a-text>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const logDiv = document.getElementById('log');
    let logs = [];
    
    function log(msg) {
      console.log(msg);
      const time = new Date().toLocaleTimeString();
      logs.push(`[${time}] ${msg}`);
      if (logs.length > 20) logs.shift();
      logDiv.innerHTML = logs.join('<br>');
    }

    log('1. Page loaded');

    // Wait for scene to load
    const scene = document.querySelector('a-scene');
    if (scene.hasLoaded) {
      log('2. Scene already loaded');
    } else {
      scene.addEventListener('loaded', () => {
        log('2. Scene loaded');
      });
    }

    // Camera video loaded
    scene.addEventListener('arjs-video-loaded', () => {
      log('3. Camera video started âœ“');
    });

    // Rendering started
    scene.addEventListener('renderstart', () => {
      log('4. Rendering started');
    });

    // Check if models loaded
    const assets = document.querySelector('a-assets');
    if (assets) {
      assets.addEventListener('loaded', () => {
        log('5. All 3D models loaded âœ“');
      });
    }

    // Get all markers
    setTimeout(() => {
      // JUNGLE
      const jungleMarker = document.getElementById('jungle-marker');
      if (jungleMarker) {
        log('6. Jungle marker ready');
        jungleMarker.addEventListener('markerFound', () => {
          log('ðŸŸ¥ JUNGLE FOUND! Capybara');
          logDiv.style.borderColor = 'red';
        });
        jungleMarker.addEventListener('markerLost', () => {
          log('Jungle lost');
          logDiv.style.borderColor = 'lime';
        });
      }

      // DESK
      const deskMarker = document.getElementById('desk-marker');
      if (deskMarker) {
        log('7. Desk marker ready');
        deskMarker.addEventListener('markerFound', () => {
          log('ðŸŸ© DESK FOUND! Watermelon');
          logDiv.style.borderColor = 'green';
        });
        deskMarker.addEventListener('markerLost', () => {
          log('Desk lost');
          logDiv.style.borderColor = 'lime';
        });
      }

      // PICNIC
      const picnicMarker = document.getElementById('picnic-marker');
      if (picnicMarker) {
        log('8. Picnic marker ready');
        picnicMarker.addEventListener('markerFound', () => {
          log('ðŸŸ¦ PICNIC FOUND! Happy Capy + Slice');
          logDiv.style.borderColor = 'blue';
        });
        picnicMarker.addEventListener('markerLost', () => {
          log('Picnic lost');
          logDiv.style.borderColor = 'lime';
        });
      }
    }, 2000);

    // Log any errors
    window.addEventListener('error', (e) => {
      log('âŒ ERROR: ' + e.message);
    });

    // Status check every 5 seconds
    setInterval(() => {
      log('Status: Camera running, waiting for marker...');
    }, 5000);
  </script>
</body>
</html>
